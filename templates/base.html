<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Attendance System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='libs/bootstrap/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='fonts/inter.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='libs/fontawesome/all.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v=19.0">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm mb-4">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="/">
                <img src="/static/photos/school_logo.png" alt="Libtong Elementary School Logo" width="40" height="40"
                    class="me-2 rounded-circle" style="object-fit:cover;">
                Student Attendance System
            </a>
            <div class="d-flex">
                {% if current_user.is_authenticated %}
                <span class="navbar-text me-3">Logged in as {{ current_user.username }}</span>
                <a href="{{ url_for('logout') }}" class="btn btn-outline-light btn-sm">Logout</a>
                {% endif %}
            </div>
        </div>
    </nav>
    <div class="container mb-5">
        <div class="row">
            <div class="col-lg-3 mb-4">
                <div class="sidebar text-center pb-3">
                    <img src="/static/photos/school_logo.png" alt="Libtong Elementary School Logo" width="60"
                        height="60" class="mb-3 rounded-circle" style="object-fit:cover;">
                    <nav class="nav flex-column">
                        <a class="nav-link {% if request.endpoint == 'dashboard' %}active{% endif %}"
                            href="{{ url_for('dashboard') }}">
                            <i class="fas fa-tachometer-alt me-2"></i>Dashboard</a>
                        <a class="nav-link {% if request.endpoint == 'view_classes' %}active{% endif %}"
                            href="{{ url_for('view_classes') }}">
                            <i class="fas fa-chalkboard-teacher me-2"></i>Manage Classes</a>
                        <a class="nav-link {% if request.endpoint == 'manage_students' %}active{% endif %}"
                            href="{{ url_for('manage_students') }}">
                            <i class="fas fa-user-graduate me-2"></i>Manage Students</a>
                        <a class="nav-link {% if request.endpoint == 'select_class_for_attendance' %}active{% endif %}"
                            href="{{ url_for('select_class_for_attendance') }}">
                            <i class="fas fa-qrcode me-2"></i>Take Attendance</a>
                        <a class="nav-link {% if request.endpoint == 'manage_records' %}active{% endif %}"
                            href="{{ url_for('manage_records') }}">
                            <i class="fas fa-chart-line me-2"></i>Attendance Records</a>
                        <a class="nav-link {% if request.endpoint == 'analytics_dashboard' %}active{% endif %}"
                            href="{{ url_for('analytics_dashboard') }}">
                            <i class="fas fa-chart-bar me-2"></i>Enhanced Analytics</a>
                        <a class="nav-link {% if request.endpoint == 'manage_excuse_requests' %}active{% endif %}"
                            href="{{ url_for('manage_excuse_requests') }}">
                            <i class="fas fa-file-medical me-2"></i>Excuse Requests</a>
                    </nav>
                </div>
            </div>
            <div class="col-lg-9">
                <!-- Toasts for flashed messages -->
                <div aria-live="polite" aria-atomic="true" class="position-relative">
                    <div id="toast-container"
                        class="toast-container position-fixed top-0 end-0 p-3 toast-container-custom">
                        {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                        {% for category, message in messages %}
                        <div class="toast align-items-center text-bg-{{ 'success' if category == 'success' else 'danger' if category == 'danger' else 'warning' if category == 'warning' else 'info' }} border-0 mb-2"
                            role="alert" aria-live="assertive" aria-atomic="true">
                            <div class="d-flex">
                                <div class="toast-body">{{ message }}</div>
                                <button type="button" class="btn-close btn-close-white me-2 m-auto"
                                    data-bs-dismiss="toast" aria-label="Close"></button>
                            </div>
                        </div>
                        {% endfor %}
                        {% endif %}
                        {% endwith %}
                        </>
                    </div>
                    {% block content %}{% endblock %}
                </div>
            </div>
        </div>
        <footer class="footer mt-auto py-3 bg-light border-top shadow-sm">
            <div class="container text-center">
                <span class="text-muted">&copy; {{ now().year }} Libtong Elementary School. All rights reserved.</span>
            </div>
        </footer>
        <script src="{{ url_for('static', filename='libs/bootstrap/bootstrap.bundle.min.js') }}"></script>
        <script>
            // Show all toasts automatically
            document.addEventListener('DOMContentLoaded', function () {
                var toastElList = [].slice.call(document.querySelectorAll('.toast'));
                toastElList.forEach(function (toastEl) {
                    var toast = new bootstrap.Toast(toastEl, { delay: 4000 });
                    toast.show();
                });
            });
        </script>
        {% block scripts %}{% endblock %}
</body>

</html>